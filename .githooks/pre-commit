#!/bin/bash
# Pre-commit hook: run SwiftLint and SwiftFormat on staged Swift files

STAGED_SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.swift$')

if [ -z "$STAGED_SWIFT_FILES" ]; then
    exit 0
fi

if command -v swiftlint &>/dev/null; then
    echo "Running SwiftLint..."
    echo "$STAGED_SWIFT_FILES" | xargs swiftlint lint --strict --quiet
    LINT_EXIT=$?
    if [ $LINT_EXIT -ne 0 ]; then
        echo "SwiftLint found violations. Fix them before committing."
        exit 1
    fi
fi

if command -v swiftformat &>/dev/null; then
    echo "Running SwiftFormat lint..."
    echo "$STAGED_SWIFT_FILES" | xargs swiftformat --lint --quiet
    FORMAT_EXIT=$?
    if [ $FORMAT_EXIT -ne 0 ]; then
        echo "SwiftFormat found issues. Run 'make format' to fix."
        exit 1
    fi
fi

exit 0
